"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.rbacMiddleware = void 0;
const rolePermissions = {
    admin: [
        "read:customers",
        "create:customers",
        "update:customers",
        "delete:customers",
        "read:vendors",
        "create:vendors",
        "update:vendors",
        "delete:vendors",
        "read:products",
        "create:products",
        "update:products",
        "delete:products",
        "read:purchases",
        "create:purchases",
        "update:purchases",
        "delete:purchases",
        "read:invoices",
        "create:invoices",
        "update:invoices",
        "delete:invoices",
        "read:reports",
        "generate:reports",
        "read:users",
        "create:users",
        "update:users",
        "delete:users",
        "read:subscription",
        "manage:subscription",
        "read:professional-requests",
        "create:professional-requests",
        "update:professional-requests",
        "delete:professional-requests",
    ],
    user: [
        "read:customers",
        "create:customers",
        "update:customers",
        "delete:customers",
        "read:vendors",
        "create:vendors",
        "update:vendors",
        "delete:vendors",
        "read:products",
        "create:products",
        "update:products",
        "delete:products",
        "read:purchases",
        "create:purchases",
        "update:purchases",
        "delete:purchases",
        "read:invoices",
        "create:invoices",
        "update:invoices",
        "delete:invoices",
        "read:reports",
        "generate:reports",
        "read:users",
        "read:subscription",
    ],
    super_user: [
        "read:customers",
        "create:customers",
        "update:customers",
        "delete:customers",
        "read:vendors",
        "create:vendors",
        "update:vendors",
        "delete:vendors",
        "read:products",
        "create:products",
        "update:products",
        "delete:products",
        "read:purchases",
        "create:purchases",
        "update:purchases",
        "delete:purchases",
        "read:invoices",
        "create:invoices",
        "update:invoices",
        "delete:invoices",
        "read:reports",
        "generate:reports",
        "read:users",
        "create:users",
        "update:users",
        "delete:users",
        "read:subscription",
        "manage:subscription",
        "read:professional-requests",
        "create:professional-requests",
        "update:professional-requests",
        "delete:professional-requests",
    ],
    professional: [
        "read:customers",
        "create:customers",
        "update:customers",
        "delete:customers",
        "read:vendors",
        "create:vendors",
        "update:vendors",
        "delete:vendors",
        "read:products",
        "create:products",
        "update:products",
        "delete:products",
        "read:purchases",
        "create:purchases",
        "update:purchases",
        "delete:purchases",
        "read:invoices",
        "create:invoices",
        "update:invoices",
        "delete:invoices",
        "read:reports",
        "generate:reports",
        "read:users",
        "create:users",
        "update:users",
        "delete:users",
        "read:subscription",
        "manage:subscription",
        "read:professional-requests",
        "create:professional-requests",
        "update:professional-requests",
        "delete:professional-requests",
    ],
    professional_user: [
        "read:customers",
        "read:vendors",
        "read:products",
        "read:purchases",
        "read:invoices",
        "create:invoices",
        "update:invoices",
        "delete:invoices",
        "read:reports",
        "generate:reports",
        "read:users",
        "read:subscription",
    ]
};
const rbacMiddleware = (permissions) => {
    return (req, res, next) => {
        const user = req.user;
        if (!user) {
            return res.status(401).json({ error: "Unauthorized" });
        }
        const effectivePermissions = user.permissions || rolePermissions[user.role] || [];
        if (!permissions.some((p) => effectivePermissions.includes(p))) {
            return res.status(403).json({ error: "Forbidden: insufficient permissions" });
        }
        next();
    };
};
exports.rbacMiddleware = rbacMiddleware;
//# sourceMappingURL=rbac.js.map